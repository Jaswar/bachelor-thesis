Looking for a split for p=0.1
Found split for p=0.1 [20 videos]
Moving sampled images to a separate folder
Finished sampling
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
Using model EMA ...

Start training model LocPointTransformer ...

[Train]: Epoch 0 started
[Train]: Epoch 0 finished with lr=0.00002041


[Train]: Epoch 1 started
[Train]: Epoch 1 finished with lr=0.00004082


[Train]: Epoch 2 started
[Train]: Epoch 2 finished with lr=0.00006122


[Train]: Epoch 3 started
[Train]: Epoch 3 finished with lr=0.00008163


[Train]: Epoch 4 started
[Train]: Epoch 4 finished with lr=0.00010000


[Train]: Epoch 5 started
[Train]: Epoch 5 finished with lr=0.00009973


[Train]: Epoch 6 started
[Train]: Epoch 6 finished with lr=0.00009891


[Train]: Epoch 7 started
[Train]: Epoch 7 finished with lr=0.00009755


[Train]: Epoch 8 started
[Train]: Epoch 8 finished with lr=0.00009568


[Train]: Epoch 9 started
[Train]: Epoch 9 finished with lr=0.00009330


[Train]: Epoch 10 started
[Train]: Epoch 10 finished with lr=0.00009045


[Train]: Epoch 11 started
[Train]: Epoch 11 finished with lr=0.00008716


[Train]: Epoch 12 started
[Train]: Epoch 12 finished with lr=0.00008346


[Train]: Epoch 13 started
[Train]: Epoch 13 finished with lr=0.00007939


[Train]: Epoch 14 started
[Train]: Epoch 14 finished with lr=0.00007500


[Train]: Epoch 15 started
[Train]: Epoch 15 finished with lr=0.00007034


[Train]: Epoch 16 started
[Train]: Epoch 16 finished with lr=0.00006545


[Train]: Epoch 17 started
[Train]: Epoch 17 finished with lr=0.00006040


[Train]: Epoch 18 started
[Train]: Epoch 18 finished with lr=0.00005523


[Train]: Epoch 19 started
[Train]: Epoch 19 finished with lr=0.00005001


[Train]: Epoch 20 started
[Train]: Epoch 20 finished with lr=0.00004478


[Train]: Epoch 21 started
[Train]: Epoch 21 finished with lr=0.00003961


[Train]: Epoch 22 started
[Train]: Epoch 22 finished with lr=0.00003456


[Train]: Epoch 23 started
[Train]: Epoch 23 finished with lr=0.00002967


[Train]: Epoch 24 started
[Train]: Epoch 24 finished with lr=0.00002501


[Train]: Epoch 25 started
[Train]: Epoch 25 finished with lr=0.00002062


[Train]: Epoch 26 started
[Train]: Epoch 26 finished with lr=0.00001655


[Train]: Epoch 27 started
[Train]: Epoch 27 finished with lr=0.00001285


[Train]: Epoch 28 started
[Train]: Epoch 28 finished with lr=0.00000956


[Train]: Epoch 29 started
[Train]: Epoch 29 finished with lr=0.00000671


[Train]: Epoch 30 started
[Train]: Epoch 30 finished with lr=0.00000433


[Train]: Epoch 31 started
[Train]: Epoch 31 finished with lr=0.00000246


[Train]: Epoch 32 started
[Train]: Epoch 32 finished with lr=0.00000110


[Train]: Epoch 33 started
[Train]: Epoch 33 finished with lr=0.00000028


[Train]: Epoch 34 started
[Train]: Epoch 34 finished with lr=0.00000001

Time taken to train: 181.63545298576355
All done!
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
=> loading checkpoint './ckpt/thumos_i3d_reproduce/epoch_035.pth.tar'
Loading from EMA model ...

Start testing model LocPointTransformer ...
Test: [00010/00212]	Time 0.56 (0.56)
Test: [00020/00212]	Time 0.10 (0.33)
Test: [00030/00212]	Time 0.10 (0.25)
Test: [00040/00212]	Time 0.11 (0.22)
Test: [00050/00212]	Time 0.11 (0.20)
Test: [00060/00212]	Time 0.09 (0.18)
Test: [00070/00212]	Time 0.09 (0.17)
Test: [00080/00212]	Time 0.10 (0.16)
Test: [00090/00212]	Time 0.09 (0.15)
Test: [00100/00212]	Time 0.13 (0.15)
Test: [00110/00212]	Time 0.12 (0.15)
Test: [00120/00212]	Time 0.10 (0.14)
Test: [00130/00212]	Time 0.10 (0.14)
Test: [00140/00212]	Time 0.11 (0.14)
Test: [00150/00212]	Time 0.09 (0.13)
Test: [00160/00212]	Time 0.13 (0.13)
Test: [00170/00212]	Time 0.14 (0.13)
Test: [00180/00212]	Time 0.17 (0.14)
Test: [00190/00212]	Time 0.11 (0.13)
Test: [00200/00212]	Time 0.10 (0.13)
Test: [00210/00212]	Time 0.09 (0.13)
Warning: No predictions of label '15' were provdied.
Warning: No predictions of label '16' were provdied.
Warning: No predictions of label '15' were provdied.
Warning: No predictions of label '16' were provdied.
[RESULTS] Action detection results on thumos14.

|tIoU = 0.30: mAP = 9.69 (%) Recall@1x = 17.27 (%) Recall@5x = 27.10 (%) 
|tIoU = 0.40: mAP = 6.61 (%) Recall@1x = 12.37 (%) Recall@5x = 19.91 (%) 
|tIoU = 0.50: mAP = 3.65 (%) Recall@1x = 8.32 (%) Recall@5x = 13.31 (%) 
|tIoU = 0.60: mAP = 1.61 (%) Recall@1x = 4.93 (%) Recall@5x = 7.49 (%) 
|tIoU = 0.70: mAP = 0.57 (%) Recall@1x = 2.91 (%) Recall@5x = 4.23 (%) 
Average mAP: 4.43 (%)
All done! Total time: 109.24 sec
Looking for a split for p=0.1
Found split for p=0.1 [20 videos]
Moving sampled images to a separate folder
Finished sampling
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
Using model EMA ...

Start training model LocPointTransformer ...

[Train]: Epoch 0 started
[Train]: Epoch 0 finished with lr=0.00002041


[Train]: Epoch 1 started
[Train]: Epoch 1 finished with lr=0.00004082


[Train]: Epoch 2 started
[Train]: Epoch 2 finished with lr=0.00006122


[Train]: Epoch 3 started
[Train]: Epoch 3 finished with lr=0.00008163


[Train]: Epoch 4 started
[Train]: Epoch 4 finished with lr=0.00010000


[Train]: Epoch 5 started
[Train]: Epoch 5 finished with lr=0.00009973


[Train]: Epoch 6 started
[Train]: Epoch 6 finished with lr=0.00009891


[Train]: Epoch 7 started
[Train]: Epoch 7 finished with lr=0.00009755


[Train]: Epoch 8 started
[Train]: Epoch 8 finished with lr=0.00009568


[Train]: Epoch 9 started
[Train]: Epoch 9 finished with lr=0.00009330


[Train]: Epoch 10 started
[Train]: Epoch 10 finished with lr=0.00009045


[Train]: Epoch 11 started
[Train]: Epoch 11 finished with lr=0.00008716


[Train]: Epoch 12 started
[Train]: Epoch 12 finished with lr=0.00008346


[Train]: Epoch 13 started
[Train]: Epoch 13 finished with lr=0.00007939


[Train]: Epoch 14 started
[Train]: Epoch 14 finished with lr=0.00007500


[Train]: Epoch 15 started
[Train]: Epoch 15 finished with lr=0.00007034


[Train]: Epoch 16 started
[Train]: Epoch 16 finished with lr=0.00006545


[Train]: Epoch 17 started
[Train]: Epoch 17 finished with lr=0.00006040


[Train]: Epoch 18 started
[Train]: Epoch 18 finished with lr=0.00005523


[Train]: Epoch 19 started
[Train]: Epoch 19 finished with lr=0.00005001


[Train]: Epoch 20 started
[Train]: Epoch 20 finished with lr=0.00004478


[Train]: Epoch 21 started
[Train]: Epoch 21 finished with lr=0.00003961


[Train]: Epoch 22 started
[Train]: Epoch 22 finished with lr=0.00003456


[Train]: Epoch 23 started
[Train]: Epoch 23 finished with lr=0.00002967


[Train]: Epoch 24 started
[Train]: Epoch 24 finished with lr=0.00002501


[Train]: Epoch 25 started
[Train]: Epoch 25 finished with lr=0.00002062


[Train]: Epoch 26 started
[Train]: Epoch 26 finished with lr=0.00001655


[Train]: Epoch 27 started
[Train]: Epoch 27 finished with lr=0.00001285


[Train]: Epoch 28 started
[Train]: Epoch 28 finished with lr=0.00000956


[Train]: Epoch 29 started
[Train]: Epoch 29 finished with lr=0.00000671


[Train]: Epoch 30 started
[Train]: Epoch 30 finished with lr=0.00000433


[Train]: Epoch 31 started
[Train]: Epoch 31 finished with lr=0.00000246


[Train]: Epoch 32 started
[Train]: Epoch 32 finished with lr=0.00000110


[Train]: Epoch 33 started
[Train]: Epoch 33 finished with lr=0.00000028


[Train]: Epoch 34 started
[Train]: Epoch 34 finished with lr=0.00000001

Time taken to train: 122.91695165634155
All done!
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
=> loading checkpoint './ckpt/thumos_i3d_reproduce/epoch_035.pth.tar'
Loading from EMA model ...

Start testing model LocPointTransformer ...
Test: [00010/00212]	Time 0.57 (0.57)
Test: [00020/00212]	Time 0.10 (0.33)
Test: [00030/00212]	Time 0.10 (0.26)
Test: [00040/00212]	Time 0.12 (0.22)
Test: [00050/00212]	Time 0.10 (0.20)
Test: [00060/00212]	Time 0.09 (0.18)
Test: [00070/00212]	Time 0.09 (0.17)
Test: [00080/00212]	Time 0.33 (0.19)
Test: [00090/00212]	Time 0.11 (0.18)
Test: [00100/00212]	Time 0.10 (0.17)
Test: [00110/00212]	Time 0.17 (0.17)
Test: [00120/00212]	Time 0.10 (0.17)
Test: [00130/00212]	Time 0.10 (0.16)
Test: [00140/00212]	Time 0.25 (0.17)
Test: [00150/00212]	Time 0.09 (0.16)
Test: [00160/00212]	Time 0.15 (0.16)
Test: [00170/00212]	Time 0.13 (0.16)
Test: [00180/00212]	Time 0.28 (0.17)
Test: [00190/00212]	Time 0.12 (0.16)
Test: [00200/00212]	Time 0.10 (0.16)
Test: [00210/00212]	Time 0.09 (0.16)
Warning: No predictions of label '15' were provdied.
Warning: No predictions of label '15' were provdied.
[RESULTS] Action detection results on thumos14.

|tIoU = 0.30: mAP = 12.02 (%) Recall@1x = 22.33 (%) Recall@5x = 33.22 (%) 
|tIoU = 0.40: mAP = 7.72 (%) Recall@1x = 15.18 (%) Recall@5x = 24.69 (%) 
|tIoU = 0.50: mAP = 4.36 (%) Recall@1x = 10.51 (%) Recall@5x = 16.65 (%) 
|tIoU = 0.60: mAP = 2.23 (%) Recall@1x = 6.94 (%) Recall@5x = 10.82 (%) 
|tIoU = 0.70: mAP = 1.08 (%) Recall@1x = 4.20 (%) Recall@5x = 6.51 (%) 
Average mAP: 5.48 (%)
All done! Total time: 201.69 sec
Looking for a split for p=0.1
Found split for p=0.1 [20 videos]
Moving sampled images to a separate folder
Finished sampling
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
Using model EMA ...

Start training model LocPointTransformer ...

[Train]: Epoch 0 started
[Train]: Epoch 0 finished with lr=0.00002041


[Train]: Epoch 1 started
[Train]: Epoch 1 finished with lr=0.00004082


[Train]: Epoch 2 started
[Train]: Epoch 2 finished with lr=0.00006122


[Train]: Epoch 3 started
[Train]: Epoch 3 finished with lr=0.00008163


[Train]: Epoch 4 started
[Train]: Epoch 4 finished with lr=0.00010000


[Train]: Epoch 5 started
[Train]: Epoch 5 finished with lr=0.00009973


[Train]: Epoch 6 started
[Train]: Epoch 6 finished with lr=0.00009891


[Train]: Epoch 7 started
[Train]: Epoch 7 finished with lr=0.00009755


[Train]: Epoch 8 started
[Train]: Epoch 8 finished with lr=0.00009568


[Train]: Epoch 9 started
[Train]: Epoch 9 finished with lr=0.00009330


[Train]: Epoch 10 started
[Train]: Epoch 10 finished with lr=0.00009045


[Train]: Epoch 11 started
[Train]: Epoch 11 finished with lr=0.00008716


[Train]: Epoch 12 started
[Train]: Epoch 12 finished with lr=0.00008346


[Train]: Epoch 13 started
[Train]: Epoch 13 finished with lr=0.00007939


[Train]: Epoch 14 started
[Train]: Epoch 14 finished with lr=0.00007500


[Train]: Epoch 15 started
[Train]: Epoch 15 finished with lr=0.00007034


[Train]: Epoch 16 started
[Train]: Epoch 16 finished with lr=0.00006545


[Train]: Epoch 17 started
[Train]: Epoch 17 finished with lr=0.00006040


[Train]: Epoch 18 started
[Train]: Epoch 18 finished with lr=0.00005523


[Train]: Epoch 19 started
[Train]: Epoch 19 finished with lr=0.00005001


[Train]: Epoch 20 started
[Train]: Epoch 20 finished with lr=0.00004478


[Train]: Epoch 21 started
[Train]: Epoch 21 finished with lr=0.00003961


[Train]: Epoch 22 started
[Train]: Epoch 22 finished with lr=0.00003456


[Train]: Epoch 23 started
[Train]: Epoch 23 finished with lr=0.00002967


[Train]: Epoch 24 started
[Train]: Epoch 24 finished with lr=0.00002501


[Train]: Epoch 25 started
[Train]: Epoch 25 finished with lr=0.00002062


[Train]: Epoch 26 started
[Train]: Epoch 26 finished with lr=0.00001655


[Train]: Epoch 27 started
[Train]: Epoch 27 finished with lr=0.00001285


[Train]: Epoch 28 started
[Train]: Epoch 28 finished with lr=0.00000956


[Train]: Epoch 29 started
[Train]: Epoch 29 finished with lr=0.00000671


[Train]: Epoch 30 started
[Train]: Epoch 30 finished with lr=0.00000433


[Train]: Epoch 31 started
[Train]: Epoch 31 finished with lr=0.00000246


[Train]: Epoch 32 started
[Train]: Epoch 32 finished with lr=0.00000110


[Train]: Epoch 33 started
[Train]: Epoch 33 finished with lr=0.00000028


[Train]: Epoch 34 started
[Train]: Epoch 34 finished with lr=0.00000001

Time taken to train: 117.26112008094788
All done!
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
=> loading checkpoint './ckpt/thumos_i3d_reproduce/epoch_035.pth.tar'
Loading from EMA model ...

Start testing model LocPointTransformer ...
Test: [00010/00212]	Time 0.56 (0.56)
Test: [00020/00212]	Time 0.10 (0.33)
Test: [00030/00212]	Time 0.09 (0.25)
Test: [00040/00212]	Time 0.11 (0.21)
Test: [00050/00212]	Time 0.10 (0.19)
Test: [00060/00212]	Time 0.09 (0.18)
Test: [00070/00212]	Time 0.09 (0.16)
Test: [00080/00212]	Time 0.10 (0.15)
Test: [00090/00212]	Time 0.10 (0.15)
Test: [00100/00212]	Time 0.10 (0.14)
Test: [00110/00212]	Time 0.11 (0.14)
Test: [00120/00212]	Time 0.09 (0.14)
Test: [00130/00212]	Time 0.12 (0.14)
Test: [00140/00212]	Time 0.10 (0.13)
Test: [00150/00212]	Time 0.09 (0.13)
Test: [00160/00212]	Time 0.13 (0.13)
Test: [00170/00212]	Time 0.13 (0.13)
Test: [00180/00212]	Time 0.10 (0.13)
Test: [00190/00212]	Time 0.11 (0.13)
Test: [00200/00212]	Time 0.10 (0.13)
Test: [00210/00212]	Time 0.10 (0.13)
Warning: No predictions of label '16' were provdied.
Warning: No predictions of label '16' were provdied.
[RESULTS] Action detection results on thumos14.

|tIoU = 0.30: mAP = 10.12 (%) Recall@1x = 19.88 (%) Recall@5x = 34.36 (%) 
|tIoU = 0.40: mAP = 6.62 (%) Recall@1x = 14.56 (%) Recall@5x = 25.86 (%) 
|tIoU = 0.50: mAP = 3.99 (%) Recall@1x = 10.12 (%) Recall@5x = 17.22 (%) 
|tIoU = 0.60: mAP = 2.34 (%) Recall@1x = 6.82 (%) Recall@5x = 11.46 (%) 
|tIoU = 0.70: mAP = 0.97 (%) Recall@1x = 4.13 (%) Recall@5x = 6.28 (%) 
Average mAP: 4.81 (%)
All done! Total time: 65.99 sec
Looking for a split for p=0.1
Found split for p=0.1 [20 videos]
Moving sampled images to a separate folder
Finished sampling
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
Using model EMA ...

Start training model LocPointTransformer ...

[Train]: Epoch 0 started
[Train]: Epoch 0 finished with lr=0.00002041


[Train]: Epoch 1 started
[Train]: Epoch 1 finished with lr=0.00004082


[Train]: Epoch 2 started
[Train]: Epoch 2 finished with lr=0.00006122


[Train]: Epoch 3 started
[Train]: Epoch 3 finished with lr=0.00008163


[Train]: Epoch 4 started
[Train]: Epoch 4 finished with lr=0.00010000


[Train]: Epoch 5 started
[Train]: Epoch 5 finished with lr=0.00009973


[Train]: Epoch 6 started
[Train]: Epoch 6 finished with lr=0.00009891


[Train]: Epoch 7 started
[Train]: Epoch 7 finished with lr=0.00009755


[Train]: Epoch 8 started
[Train]: Epoch 8 finished with lr=0.00009568


[Train]: Epoch 9 started
[Train]: Epoch 9 finished with lr=0.00009330


[Train]: Epoch 10 started
[Train]: Epoch 10 finished with lr=0.00009045


[Train]: Epoch 11 started
[Train]: Epoch 11 finished with lr=0.00008716


[Train]: Epoch 12 started
[Train]: Epoch 12 finished with lr=0.00008346


[Train]: Epoch 13 started
[Train]: Epoch 13 finished with lr=0.00007939


[Train]: Epoch 14 started
[Train]: Epoch 14 finished with lr=0.00007500


[Train]: Epoch 15 started
[Train]: Epoch 15 finished with lr=0.00007034


[Train]: Epoch 16 started
[Train]: Epoch 16 finished with lr=0.00006545


[Train]: Epoch 17 started
[Train]: Epoch 17 finished with lr=0.00006040


[Train]: Epoch 18 started
[Train]: Epoch 18 finished with lr=0.00005523


[Train]: Epoch 19 started
[Train]: Epoch 19 finished with lr=0.00005001


[Train]: Epoch 20 started
[Train]: Epoch 20 finished with lr=0.00004478


[Train]: Epoch 21 started
[Train]: Epoch 21 finished with lr=0.00003961


[Train]: Epoch 22 started
[Train]: Epoch 22 finished with lr=0.00003456


[Train]: Epoch 23 started
[Train]: Epoch 23 finished with lr=0.00002967


[Train]: Epoch 24 started
[Train]: Epoch 24 finished with lr=0.00002501


[Train]: Epoch 25 started
[Train]: Epoch 25 finished with lr=0.00002062


[Train]: Epoch 26 started
[Train]: Epoch 26 finished with lr=0.00001655


[Train]: Epoch 27 started
[Train]: Epoch 27 finished with lr=0.00001285


[Train]: Epoch 28 started
[Train]: Epoch 28 finished with lr=0.00000956


[Train]: Epoch 29 started
[Train]: Epoch 29 finished with lr=0.00000671


[Train]: Epoch 30 started
[Train]: Epoch 30 finished with lr=0.00000433


[Train]: Epoch 31 started
[Train]: Epoch 31 finished with lr=0.00000246


[Train]: Epoch 32 started
[Train]: Epoch 32 finished with lr=0.00000110


[Train]: Epoch 33 started
[Train]: Epoch 33 finished with lr=0.00000028


[Train]: Epoch 34 started
[Train]: Epoch 34 finished with lr=0.00000001

Time taken to train: 118.04211354255676
All done!
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
=> loading checkpoint './ckpt/thumos_i3d_reproduce/epoch_035.pth.tar'
Loading from EMA model ...

Start testing model LocPointTransformer ...
Test: [00010/00212]	Time 0.54 (0.54)
Test: [00020/00212]	Time 0.10 (0.32)
Test: [00030/00212]	Time 0.10 (0.25)
Test: [00040/00212]	Time 0.11 (0.21)
Test: [00050/00212]	Time 0.11 (0.19)
Test: [00060/00212]	Time 0.09 (0.18)
Test: [00070/00212]	Time 0.09 (0.16)
Test: [00080/00212]	Time 0.10 (0.16)
Test: [00090/00212]	Time 0.09 (0.15)
Test: [00100/00212]	Time 0.11 (0.14)
Test: [00110/00212]	Time 0.12 (0.14)
Test: [00120/00212]	Time 0.09 (0.14)
Test: [00130/00212]	Time 0.25 (0.15)
Test: [00140/00212]	Time 0.10 (0.14)
Test: [00150/00212]	Time 0.27 (0.15)
Test: [00160/00212]	Time 0.16 (0.15)
Test: [00170/00212]	Time 0.14 (0.15)
Test: [00180/00212]	Time 0.13 (0.15)
Test: [00190/00212]	Time 0.12 (0.15)
Test: [00200/00212]	Time 0.10 (0.15)
Test: [00210/00212]	Time 0.08 (0.14)
[RESULTS] Action detection results on thumos14.

|tIoU = 0.30: mAP = 7.92 (%) Recall@1x = 17.68 (%) Recall@5x = 28.17 (%) 
|tIoU = 0.40: mAP = 4.93 (%) Recall@1x = 12.87 (%) Recall@5x = 20.30 (%) 
|tIoU = 0.50: mAP = 2.72 (%) Recall@1x = 8.45 (%) Recall@5x = 13.49 (%) 
|tIoU = 0.60: mAP = 1.39 (%) Recall@1x = 5.65 (%) Recall@5x = 8.11 (%) 
|tIoU = 0.70: mAP = 0.49 (%) Recall@1x = 3.13 (%) Recall@5x = 4.31 (%) 
Average mAP: 3.49 (%)
All done! Total time: 316.16 sec
Looking for a split for p=0.1
Found split for p=0.1 [20 videos]
Moving sampled images to a separate folder
Finished sampling
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
Using model EMA ...

Start training model LocPointTransformer ...

[Train]: Epoch 0 started
[Train]: Epoch 0 finished with lr=0.00002041


[Train]: Epoch 1 started
[Train]: Epoch 1 finished with lr=0.00004082


[Train]: Epoch 2 started
[Train]: Epoch 2 finished with lr=0.00006122


[Train]: Epoch 3 started
[Train]: Epoch 3 finished with lr=0.00008163


[Train]: Epoch 4 started
[Train]: Epoch 4 finished with lr=0.00010000


[Train]: Epoch 5 started
[Train]: Epoch 5 finished with lr=0.00009973


[Train]: Epoch 6 started
[Train]: Epoch 6 finished with lr=0.00009891


[Train]: Epoch 7 started
[Train]: Epoch 7 finished with lr=0.00009755


[Train]: Epoch 8 started
[Train]: Epoch 8 finished with lr=0.00009568


[Train]: Epoch 9 started
[Train]: Epoch 9 finished with lr=0.00009330


[Train]: Epoch 10 started
[Train]: Epoch 10 finished with lr=0.00009045


[Train]: Epoch 11 started
[Train]: Epoch 11 finished with lr=0.00008716


[Train]: Epoch 12 started
[Train]: Epoch 12 finished with lr=0.00008346


[Train]: Epoch 13 started
[Train]: Epoch 13 finished with lr=0.00007939


[Train]: Epoch 14 started
[Train]: Epoch 14 finished with lr=0.00007500


[Train]: Epoch 15 started
[Train]: Epoch 15 finished with lr=0.00007034


[Train]: Epoch 16 started
[Train]: Epoch 16 finished with lr=0.00006545


[Train]: Epoch 17 started
[Train]: Epoch 17 finished with lr=0.00006040


[Train]: Epoch 18 started
[Train]: Epoch 18 finished with lr=0.00005523


[Train]: Epoch 19 started
[Train]: Epoch 19 finished with lr=0.00005001


[Train]: Epoch 20 started
[Train]: Epoch 20 finished with lr=0.00004478


[Train]: Epoch 21 started
[Train]: Epoch 21 finished with lr=0.00003961


[Train]: Epoch 22 started
[Train]: Epoch 22 finished with lr=0.00003456


[Train]: Epoch 23 started
[Train]: Epoch 23 finished with lr=0.00002967


[Train]: Epoch 24 started
[Train]: Epoch 24 finished with lr=0.00002501


[Train]: Epoch 25 started
[Train]: Epoch 25 finished with lr=0.00002062


[Train]: Epoch 26 started
[Train]: Epoch 26 finished with lr=0.00001655


[Train]: Epoch 27 started
[Train]: Epoch 27 finished with lr=0.00001285


[Train]: Epoch 28 started
[Train]: Epoch 28 finished with lr=0.00000956


[Train]: Epoch 29 started
[Train]: Epoch 29 finished with lr=0.00000671


[Train]: Epoch 30 started
[Train]: Epoch 30 finished with lr=0.00000433


[Train]: Epoch 31 started
[Train]: Epoch 31 finished with lr=0.00000246


[Train]: Epoch 32 started
[Train]: Epoch 32 finished with lr=0.00000110


[Train]: Epoch 33 started
[Train]: Epoch 33 finished with lr=0.00000028


[Train]: Epoch 34 started
[Train]: Epoch 34 finished with lr=0.00000001

Time taken to train: 131.24273872375488
All done!
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
/home/jwarchocki/.conda/envs/action-former/lib/python3.10/site-packages/torch/utils/data/dataloader.py:554: UserWarning: This DataLoader will create 4 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
{'dataset': {'crop_ratio': [0.9, 1.0],
             'default_fps': None,
             'downsample_rate': 1,
             'feat_folder': './data/thumos/i3d_features',
             'feat_stride': 4,
             'file_ext': '.npy',
             'file_prefix': None,
             'force_upsampling': False,
             'input_dim': 2048,
             'json_file': './data/thumos/annotations/thumos14.json',
             'max_seq_len': 2304,
             'num_classes': 20,
             'num_frames': 16,
             'trunc_thresh': 0.5},
 'dataset_name': 'thumos',
 'devices': ['cuda:0'],
 'init_rand_seed': 1234567891,
 'loader': {'batch_size': 2, 'num_workers': 4},
 'model': {'backbone_arch': (2, 2, 5),
           'backbone_type': 'convTransformer',
           'embd_dim': 512,
           'embd_kernel_size': 3,
           'embd_with_ln': True,
           'fpn_dim': 512,
           'fpn_start_level': 0,
           'fpn_type': 'identity',
           'fpn_with_ln': True,
           'head_dim': 512,
           'head_kernel_size': 3,
           'head_num_layers': 3,
           'head_with_ln': True,
           'input_dim': 2048,
           'max_buffer_len_factor': 6.0,
           'max_seq_len': 2304,
           'n_head': 4,
           'n_mha_win_size': 19,
           'num_classes': 20,
           'regression_range': [(0, 4),
                                (4, 8),
                                (8, 16),
                                (16, 32),
                                (32, 64),
                                (64, 10000)],
           'scale_factor': 2,
           'test_cfg': {'duration_thresh': 0.05,
                        'ext_score_file': None,
                        'iou_threshold': 0.1,
                        'max_seg_num': 200,
                        'min_score': 0.001,
                        'multiclass_nms': True,
                        'nms_method': 'soft',
                        'nms_sigma': 0.5,
                        'pre_nms_thresh': 0.001,
                        'pre_nms_topk': 2000,
                        'voting_thresh': 0.7},
           'train_cfg': {'center_sample': 'radius',
                         'center_sample_radius': 1.5,
                         'clip_grad_l2norm': 1.0,
                         'cls_prior_prob': 0.01,
                         'dropout': 0.0,
                         'droppath': 0.1,
                         'head_empty_cls': [],
                         'init_loss_norm': 100,
                         'label_smoothing': 0.0,
                         'loss_weight': 1.0},
           'use_abs_pe': False,
           'use_rel_pe': False},
 'model_name': 'LocPointTransformer',
 'opt': {'epochs': 30,
         'learning_rate': 0.0001,
         'momentum': 0.9,
         'schedule_gamma': 0.1,
         'schedule_steps': [],
         'schedule_type': 'cosine',
         'type': 'AdamW',
         'warmup': True,
         'warmup_epochs': 5,
         'weight_decay': 0.05},
 'output_folder': './ckpt/',
 'test_cfg': {'duration_thresh': 0.05,
              'ext_score_file': None,
              'iou_threshold': 0.1,
              'max_seg_num': 200,
              'min_score': 0.001,
              'multiclass_nms': True,
              'nms_method': 'soft',
              'nms_sigma': 0.5,
              'pre_nms_thresh': 0.001,
              'pre_nms_topk': 2000,
              'voting_thresh': 0.7},
 'train_cfg': {'center_sample': 'radius',
               'center_sample_radius': 1.5,
               'clip_grad_l2norm': 1.0,
               'cls_prior_prob': 0.01,
               'dropout': 0.0,
               'droppath': 0.1,
               'head_empty_cls': [],
               'init_loss_norm': 100,
               'label_smoothing': 0.0,
               'loss_weight': 1.0},
 'train_split': ['validation'],
 'val_split': ['test']}
=> loading checkpoint './ckpt/thumos_i3d_reproduce/epoch_035.pth.tar'
Loading from EMA model ...

Start testing model LocPointTransformer ...
Test: [00010/00212]	Time 0.85 (0.85)
Test: [00020/00212]	Time 0.11 (0.48)
Test: [00030/00212]	Time 0.10 (0.35)
Test: [00040/00212]	Time 0.12 (0.29)
Test: [00050/00212]	Time 0.11 (0.26)
Test: [00060/00212]	Time 0.10 (0.23)
Test: [00070/00212]	Time 0.09 (0.21)
Test: [00080/00212]	Time 0.10 (0.20)
Test: [00090/00212]	Time 0.10 (0.18)
Test: [00100/00212]	Time 0.11 (0.18)
Test: [00110/00212]	Time 0.11 (0.17)
Test: [00120/00212]	Time 0.10 (0.17)
Test: [00130/00212]	Time 0.11 (0.16)
Test: [00140/00212]	Time 0.10 (0.16)
Test: [00150/00212]	Time 0.10 (0.15)
Test: [00160/00212]	Time 0.14 (0.15)
Test: [00170/00212]	Time 0.13 (0.15)
Test: [00180/00212]	Time 0.11 (0.15)
Test: [00190/00212]	Time 0.12 (0.15)
Test: [00200/00212]	Time 0.10 (0.14)
Test: [00210/00212]	Time 0.09 (0.14)
[RESULTS] Action detection results on thumos14.

|tIoU = 0.30: mAP = 10.23 (%) Recall@1x = 20.59 (%) Recall@5x = 32.85 (%) 
|tIoU = 0.40: mAP = 6.71 (%) Recall@1x = 14.76 (%) Recall@5x = 23.85 (%) 
|tIoU = 0.50: mAP = 3.78 (%) Recall@1x = 9.87 (%) Recall@5x = 15.65 (%) 
|tIoU = 0.60: mAP = 1.32 (%) Recall@1x = 5.28 (%) Recall@5x = 8.32 (%) 
|tIoU = 0.70: mAP = 0.55 (%) Recall@1x = 2.86 (%) Recall@5x = 4.05 (%) 
Average mAP: 4.52 (%)
All done! Total time: 177.31 sec
